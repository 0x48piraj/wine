DEFS       = @DLLFLAGS@ -DSTRICT -DNONAMELESSUNION -DNONAMELESSSTRUCT $(EXTRADEFS)
LDDLLFLAGS = @LDDLLFLAGS@
TOPSRCDIR  = @top_srcdir@
TOPOBJDIR  = ../..
SRCDIR     = @srcdir@
VPATH      = @srcdir@
MODULE     = none
PROGRAMS   = icinfo aviinfo aviplay
ALL_LIBS   = $(LIBWINE) $(LIBS)

all: $(PROGRAMS)

@MAKE_RULES@

aviinfo.spec.c: aviinfo.o $(WINEBUILD)
	$(LDPATH) $(WINEBUILD) $(DEFS) -sym aviinfo.o -o aviinfo.spec.c -exe aviinfo -mgui -L$(DLLDIR) -lkernel32

aviplay.spec.c: aviplay.o $(WINEBUILD)
	$(LDPATH) $(WINEBUILD) $(DEFS) -sym aviplay.o -o aviplay.spec.c -exe aviplay -mgui -L$(DLLDIR) -lddraw -lkernel32

icinfo.spec.c: icinfo.o $(WINEBUILD)
	$(LDPATH) $(WINEBUILD) $(DEFS) -sym icinfo.o -o icinfo.spec.c -exe icinfo -mgui -L$(DLLDIR) -lmsvfw32 -lkernel32

aviinfo.so: aviinfo.o aviinfo.spec.o
	$(LDSHARED) $(LDDLLFLAGS) -o aviinfo.so aviinfo.o aviinfo.spec.o $(ALL_LIBS)

aviplay.so: aviplay.o aviplay.spec.o
	$(LDSHARED) $(LDDLLFLAGS) -o aviplay.so aviplay.o aviplay.spec.o $(ALL_LIBS)

icinfo.so: icinfo.o icinfo.spec.o
	$(LDSHARED) $(LDDLLFLAGS) -o icinfo.so icinfo.o icinfo.spec.o $(ALL_LIBS)

aviinfo: aviinfo.so
	$(RM) aviinfo && $(LN_S) $(TOPOBJDIR)/wine aviinfo

aviplay: aviplay.so
	$(RM) aviplay && $(LN_S) $(TOPOBJDIR)/wine aviplay

icinfo: icinfo.so
	$(RM) icinfo && $(LN_S) $(TOPOBJDIR)/wine icinfo

install:: $(PROGRAMS:%=%.so)
	$(MKINSTALLDIRS) $(bindir)
	$(INSTALL_PROGRAM) aviinfo.so $(bindir)/aviinfo.so
	$(INSTALL_PROGRAM) aviplay.so $(bindir)/aviplay.so
	$(INSTALL_PROGRAM) icinfo.so $(bindir)/icinfo.so
	cd $(bindir) && $(LN_S) wine aviinfo && $(LN_S) wine aviplay && $(LN_S) wine icinfo

uninstall::
	$(RM) $(bindir)/aviinfo.so $(bindir)/aviplay.so $(bindir)/icinfo.so
	$(RM) $(bindir)/aviinfo $(bindir)/aviplay $(bindir)/icinfo

checklink:: $(PROGRAMS:%=%.so)
	$(CC) -o checklink $(TOPSRCDIR)/library/checklink.c aviinfo.so && $(RM) checklink
	$(CC) -o checklink $(TOPSRCDIR)/library/checklink.c aviplay.so && $(RM) checklink
	$(CC) -o checklink $(TOPSRCDIR)/library/checklink.c icinfo.so && $(RM) checklink

### Dependencies:
